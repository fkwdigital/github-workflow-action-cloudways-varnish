(()=>{var e={793:e=>{const o="https://api.cloudways.com/api/v1";async function getAccessToken(e,t){console.log("[API] Obtaining OAuth access token...");const n=await fetch(`${o}/oauth/access_token`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,api_key:t})});const r=await n.json();if(!r.access_token){throw new Error(`Failed to obtain access token: ${JSON.stringify(r)}`)}console.log("✅ [API] Access token obtained");return r.access_token}async function executeVarnishAction(e,t,n){const r=n==="purge"?`${o}/service/varnish_purge`:`${o}/service/state`;const i=n==="purge"?{server_id:parseInt(t,10)}:{server_id:parseInt(t,10),service:"varnish",state:n==="enable"?"start":"stop"};console.log(`[API] Executing Varnish ${n} on server ${t}...`);const s=await fetch(r,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify(i)});const a=await s.json();if(!a.operation||!a.operation.id){throw new Error(`Operation failed: ${JSON.stringify(a)}`)}console.log(`✅ [API] Operation initiated (ID: ${a.operation.id})`);return a.operation}async function checkOperationStatus(e,t){const n=await fetch(`${o}/operation/${t}`,{method:"GET",headers:{Authorization:`Bearer ${e}`}});return n.json()}async function waitForCompletion(e,o,t=30,n=5e3){console.log("[API] Waiting for operation to complete...");for(let r=1;r<=t;r++){await new Promise((e=>setTimeout(e,n)));const t=await checkOperationStatus(e,o);if(t.operation&&t.operation.is_completed){console.log("✅ [API] Operation completed successfully");return t.operation}process.stdout.write(".")}console.log("");throw new Error(`Operation timed out after ${t} attempts (ID: ${o})`)}e.exports={getAccessToken:getAccessToken,executeVarnishAction:executeVarnishAction,checkOperationStatus:checkOperationStatus,waitForCompletion:waitForCompletion}},700:e=>{const o=["enable","disable","purge"];function fromEnv(e,o=""){const t=Object.prototype.hasOwnProperty.call(process.env,e);const n=t?process.env[e]:process.env[`INPUT_${e}`];return n===undefined||n===null||n===""?o:n}function getInputs(){return{email:fromEnv("CLOUDWAYS_EMAIL"),apiKey:fromEnv("CLOUDWAYS_API_KEY"),serverId:fromEnv("CLOUDWAYS_SERVER_ID"),action:fromEnv("ACTION","enable").toLowerCase(),waitForCompletion:fromEnv("WAIT_FOR_COMPLETION","true")==="true"}}function assertRequired(e){const t=[];if(!e.email)t.push("CLOUDWAYS_EMAIL");if(!e.apiKey)t.push("CLOUDWAYS_API_KEY");if(!e.serverId)t.push("SERVER_ID");if(t.length){throw new Error(`Missing required inputs: ${t.join(", ")}`)}if(!o.includes(e.action)){throw new Error(`Invalid ACTION '${e.action}'. Must be one of: ${o.join(", ")}`)}}e.exports={getInputs:getInputs,assertRequired:assertRequired,VALID_ACTIONS:o}}};var o={};function __nccwpck_require__(t){var n=o[t];if(n!==undefined){return n.exports}var r=o[t]={exports:{}};var i=true;try{e[t](r,r.exports,__nccwpck_require__);i=false}finally{if(i)delete o[t]}return r.exports}if(typeof __nccwpck_require__!=="undefined")__nccwpck_require__.ab=__dirname+"/";var t={};const{getInputs:n,assertRequired:r}=__nccwpck_require__(700);const{getAccessToken:i,executeVarnishAction:s,waitForCompletion:a}=__nccwpck_require__(793);async function main(){try{const e=n();r(e);console.log(`[Varnish] Action: ${e.action}`);console.log(`[Varnish] Server ID: ${e.serverId}`);console.log(`[Varnish] Wait for completion: ${e.waitForCompletion}`);const o=await i(e.email,e.apiKey);const t=await s(o,e.serverId,e.action);if(e.waitForCompletion){await a(o,t.id);console.log("✅ [Varnish] Operation completed successfully")}else{console.log(`✅ [Varnish] Operation initiated (ID: ${t.id})`);console.log("   Use the operation ID to check status later")}process.exit(0)}catch(e){console.error("⚠️ [Varnish] Error:",e.message);process.exit(1)}}main();module.exports=t})();